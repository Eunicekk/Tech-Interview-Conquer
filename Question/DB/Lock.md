# Concurrency
---

## 면접 질문 예시

> "락이란 무엇이고, 데이터베이스에서 락을 왜 사용하는지 설명해보세요. 락의 유형에 대해 설명해보세요."

---

<details>
  <summary><h2> 평가 요소 및 모범 답안</h2></summary>

  ### 1. 락
  - 포함내용
    * 정의 : 여러 트랜잭션이 동시에 동일한 데이터에 접근할 때, 데이터의 정합성과 일관성을 보장하기 위해 해당 자원을 잠그는 동기화 기법
    * 사용 목적 : 동시성 제어를 통해 발생할 수 있는 문제(Dirty Read, Lost Update 등)를 방지하기 위해 사용
    * 락의 유형
      - 공유 락(Shared Lock) : 데이터를 읽을 수만 있고 수정은 할 수 없는 락. 여러 트랜잭션이 동시에 공유 락을 획득할 수 있어 읽기는 병렬로 가능하지만, 쓰기 작업은 불가능 
      - 배타 락(Exclusive Lock) : 데이터를 읽고 쓸 수 있는 락. 이 락을 획득한 트랜잭션만 해당 데이터를 읽고 쓸 수 있다.(독점)
     
  ### 2. 낙관적 락 vs 비관적 락
  - 포함내용
    * 낙관적 락 : 충돌이 거의 없다고 가정하기 때문에, 데이터를 수정하기 전까지 락을 걸지 않는 전략. 대신 커밋 시점에 버전을 비교하여 변경 충돌 여부 확인
      - 충돌 발생 시 예외 처리 및 재시도
      - 충돌이 드물고, 주로 읽기 작업이 많고 쓰기가 적은 시스템에서 쓰인다.
    * 비관적 락 : 충돌이 있을 것 이라고 가정하기 때문에, 데이터를 수정하기 전 락을 걸어 다른 트랜잭션의 접근을 차단하는 전략.
      - 아예 충돌이 발생하지 않도록 선점
      - 충돌 가능성이 높고, 데이터 정합성이 매우 중요한 시스템에서 쓰인다.
     
  ### 3. 심화 지식
  - 포함내용
    * 업데이트가 자주 발생하는 테이블에서 성능 저하를 최소화하면서 락을 효율적으로 제어하려면?
      - 트랜잭션 범위 최소화 : 트랜잭션이 길어질수록 락이 오래 유지되어 다른 트랜잭션을 막음 (비즈니스 로직과 분리하여 트랜잭션은 가능한 짧게 유지)
      - 충돌이 적다면 낙관적 락 적용
      - 비관적 락은 꼭 필요한 곳에만 제한적으로 적용
      - 격리 수준 조정 : DB의 트랜잭션 격리 수준을 너무 높게 설정하면 락이 많이 걸리기 때문에, 필요해 따라 READ COMMITTED로 설정
